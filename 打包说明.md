# VideoTrans Detection 应用打包说明

## 概述
本文档说明如何将 `gui_main.py` Python应用打包成独立的Windows可执行文件(.exe)。

## 准备工作

### 1. 安装Python依赖
```bash
# 安装所有必要的依赖包
pip install -r requirements.txt
```
**注意**：本项目使用本地修改过的ultralytics版本（位于`d:\AndroidStudioProjects\VideoTrans\ultralytics`），包含自定义的FRFN.py和SEAM.py模块，无需从PyPI安装ultralytics。

### 2. 确保必要文件存在
打包前请确保以下文件在项目目录中：
- `gui_main.py` - 主程序文件
- `tracker.py` - 目标跟踪模块
- `python_receiver.py` - 视频接收模块
- `yolo11n.pt` - 预训练YOLO模型文件
- `best.pt` - 自定义训练的YOLO模型文件
- `ultralytics/` - 本地修改版本的YOLO框架目录（包含FRFN.py、SEAM.py等自定义模块）

## 打包步骤

### 方法一：使用自动化脚本（推荐）
```bash
# 执行打包
python build_exe.py

# 如果需要清理之前的构建文件
python build_exe.py clean
```

### 方法二：手动使用PyInstaller
```bash
pyinstaller --onefile --windowed --name=VideoTrans_Detection \
    --add-data="yolo11n.pt;." \
    --add-data="best.pt;." \
    --add-data="ultralytics;ultralytics" \
    --hidden-import=ultralytics \
    --hidden-import=cv2 \
    --hidden-import=torch \
    gui_main.py
```

## 打包配置说明

### 打包选项
- `--onefile`: 打包成单个exe文件
- `--windowed`: 不显示控制台窗口（GUI应用）
- `--name`: 指定生成的exe文件名
- `--add-data`: 添加数据文件到打包中
  - `yolo11n.pt`: 预训练YOLO模型文件
  - `best.pt`: 自定义训练的YOLO模型文件
  - `ultralytics`: 本地修改过的ultralytics包
- `--hidden-import`: 显式导入可能被遗漏的模块
  - 包含自定义模块：`ultralytics.nn.FRFN`、`ultralytics.nn.SEAM`

### 包含的文件
- YOLO模型文件 (`yolo11n.pt`, `best.pt`)
- 本地修改版本的Ultralytics框架（包含自定义FRFN.py和SEAM.py模块）
- 所有Python依赖库

### 排除的模块
为了减小文件大小，排除了以下非必要模块：
- matplotlib
- scipy 
- pandas
- jupyter
- IPython

## 输出文件

打包完成后，可执行文件将位于：
```
dist/VideoTrans_Detection.exe
```

## 常见问题解决

### 1. 模块导入错误
如果运行时出现模块找不到的错误，在 `build_exe.py` 中添加：
```python
"--hidden-import=模块名"
```

### 2. 文件大小过大
- 确保排除了不必要的模块
- 考虑使用 `--exclude-module` 排除更多模块
- 可以选择不使用 `--onefile`，改为目录分发

### 3. 运行时错误
- 确保所有数据文件都通过 `--add-data` 正确添加
- 检查路径分隔符（Windows使用 `;`，Linux/Mac使用 `:`）

### 4. PyTorch CPU版本
确保使用CPU版本的PyTorch以避免CUDA依赖：
```bash
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
```

## 分发注意事项

### 系统要求
- Windows 10/11 (64位)
- 无需安装Python环境
- 如使用摄像头功能，需要摄像头驱动
- 如使用USB手机功能，需要ADB工具

### 首次运行
- 首次运行可能需要下载一些模型文件
- 建议在有网络连接的环境下首次运行
- 杀毒软件可能会误报，需要添加信任

### 文件结构（如果不使用--onefile）
```
VideoTrans_Detection/
├── VideoTrans_Detection.exe
├── yolo11n.pt
├── best.pt
├── ultralytics/
└── _internal/  # PyInstaller生成的依赖文件
```

## 优化建议

1. **减小文件大小**：
   - 使用虚拟环境，只安装必要的包
   - 排除更多不需要的模块
   - 考虑使用UPX压缩

2. **提高启动速度**：
   - 不使用 `--onefile`，改为目录分发
   - 预编译Python字节码

3. **增强兼容性**：
   - 在目标系统上测试
   - 添加必要的Visual C++运行库

## 故障排除

如果打包失败，请检查：
1. Python版本兼容性（推荐Python 3.8-3.11）
2. 所有依赖是否正确安装
3. 是否有足够的磁盘空间
4. 杀毒软件是否阻止了打包过程

如果运行失败，请检查：
1. 是否缺少系统依赖
2. 路径中是否包含中文或特殊字符
3. 是否有足够的内存
4. 模型文件是否正确包含